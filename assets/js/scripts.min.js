var admin={init:function(){ajax.getUsers("returnAdminUsers"),this.bindEvents()},bindEvents:function(){admin.validateAddUser(),admin.validateEditUser(),admin.validateEditCong(),admin.validateAddCong()},validateAddUser:function(){$("form[name='addUserSubmit']").validate({rules:{email:{required:!0,email:!0},password:{required:!0,minlength:8,maxlength:50},phoneNumber:{required:!0,phoneUS:!0},firstName:{required:!0,maxlength:200},lastName:{required:!0,maxlength:200}},submitHandler:function(e){e.submit()}})},validateEditUser:function(){$("form[name='editUserSubmit']").validate({rules:{email:{required:!0,email:!0},phoneNumber:{required:!0,phoneUS:!0},firstName:{required:!0,maxlength:200},lastName:{required:!0,maxlength:200}},submitHandler:function(e){e.submit()}})},validateEditCong:function(){$("form[name='editCongSubmit']").validate({rules:{congregation_name:{required:!0,maxlength:200},congregation_phone:{required:!0,phoneUS:!0},congregation_street_address:{required:!0,maxlength:200},congregation_city:{required:!0,maxlength:200},congregation_state:{required:!0,minlength:2,maxlength:2,lettersonly:!0},congregation_zip:{required:!0,minlength:5,maxlength:5,number:!0}},submitHandler:function(e){e.submit()}})},validateAddCong:function(){$("form[name='addCongSubmit']").validate({rules:{congregation_name:{required:!0,maxlength:200},congregation_phone:{required:!0,phoneUS:!0},congregation_street_address:{required:!0,maxlength:200},congregation_city:{required:!0,maxlength:200},congregation_state:{required:!0,minlength:2,maxlength:2,lettersonly:!0},congregation_zip:{required:!0,minlength:5,maxlength:5,number:!0}},submitHandler:function(e){e.submit()}})}},bus_schedule={init:function(){this.bindEvents()},bindEvents:function(){$("table#schedule-list").on("click","a#clearRoles",function(e){e.preventDefault();var t=$(this).siblings("input");bus_schedule.clearRoles(t)}),$("#busScheduleSubmit").on("click",function(e){e.preventDefault(),bus_schedule.submitSchedule()})},clearRoles:function(e){$.each(e,function(e,t){$(t).prop("checked",!1)})},submitSchedule:function(){var e,t=$("table#schedule-list tbody"),a=$("#availErrorContainer"),i=t.find("tr"),n=[],r={},l="";$(i).each(function(e,t){r.isDriver="0",r.isBackup="0",r.day=$("#schedule-header-date").text(),a.empty(),$(this).children("td").each(function(e,t){if(r.id=$("#bus-name").val(),this.classList.contains("tableDriverName")&&0==e&&(r.driver=$(this).text()),this.classList.contains("tableDriverTime")&&1==e&&(l=$(this).text(),r.time=$(this).text()),this.classList.contains("roleSelect")&&2==e){var a=$(this).children(":checked").val();"AM"===l&&("driver"===a&&(hasAMDriver=!0,r.isDriver="1"),"backup"===a&&(hasAMBackup=!0,r.isBackup="1")),"PM"===l&&("driver"===a&&(hasPMDriver=!0,r.isDriver="1"),"backup"===a&&(hasPMBackup=!0,r.isBackup="1"))}2==e&&(n.push(r),r={})})}),e=JSON.stringify(n,null,2),bus_schedule.errorCheck(e)&&ajax.submitBusDriverSchedule("handleBusDriverSchedule",e)},errorCheck:function(e){var t=$("#availErrorContainer");t.empty();var a=!1,i=!1,n=!1,r=!1,l=JSON.parse(e).length,s=!0;return $.each($.parseJSON(e),function(e,o){"AM"==o.time&&(1==o.isDriver&&(0==a?a=!0:(s=!1,t.append('<h3 class="noAvailError">A driver is already exists for AM</h3>'))),1==o.isBackup&&(0==i?i=!0:(s=!1,t.append('<h3 class="noAvailError">A backup is already exists for AM</h3>')))),"PM"==o.time&&(1==o.isDriver&&(0==n?n=!0:(s=!1,t.append('<h3 class="noAvailError">A driver is already exists for PM</h3>'))),1==o.isBackup&&(0==r?r=!0:(s=!1,t.append('<h3 class="noAvailError">A backup is already exists for PM</h3>')))),parseInt(e+1)==l&&(0==a&&(s=!1,t.append('<h3 class="noAvailError">A driver is required for AM</h3>')),0==n&&(s=!1,t.append('<h3 class="noAvailError">A driver is required for PM</h3>')))}),s}},bus={init:function(){this.bindEvents(),this.populateDrivers()},populateDrivers:function(){ajax.getDrivers("returnDrivers")},bindEvents:function(){$(".add-to-list").on("click",function(e){var t=!1;e.preventDefault(),$("#error-container").empty(),""==$("#bus-name").val()&&(t=!0,$("#error-container").append("<p>A driver is required.</p>")),""==$("#bus-date").val()&&(t=!0,$("#error-container").append("<p>Date(s) is/are required.</p>")),""==$("#bus-time").val()&&(t=!0,$("#error-container").append("<p>Time is required.</p>")),t||bus.populateTable()}),$("#driver-avail-submit").on("click",function(e){e.preventDefault(),bus.submitAvailability()}),$("table#list").on("click","a#delete-date",function(e){e.preventDefault(),bus.removeDriverRecord(this)}),$("#bus-name").on("change",function(e){$("option:selected",this);var t=this.value;""!=t&&ajax.getDriverAvailability("returnDriverAvailability",t)})},populateTable:function(){var e,t=$("#bus-name").find(":selected").text(),a=$("#bus-date").val().split(", "),i=$("#bus-time").val(),n=$("table#list tbody");if(0==bus.checkExists(a))for(var r=0;r<a.length;r++)e="<tr>",e+='<td scope="row" class="tableDriverName">'+t+"</td>",e+='<td class="tableDriverDate">'+a[r]+"</td>",e+='<td class="tableDriverTime" >'+i+'<a id="delete-date"><i class="fa fa-minus-circle fa-lg pull-right" aria-hidden="true"></i></a></td>',e+="</tr>",n.append(e);$("#date-picker").multiDatesPicker("removeIndexes",0)},checkExists:function(e){var t=$("#error-container"),a=($("table#list tbody"),$("table#list tbody > tr > td.tableDriverDate")),i=!1;return t.empty(),a.length>0?$.each(e,function(e,n){$.each(a,function(e,a){$(a).text()==n&&(t.append("<p>Availability Already Exists on "+n+"</p>"),i=!0)})}):i=!1,i},removeDriverRecord:function(e){$(e).parents().closest("tr").empty().remove()},submitAvailability:function(){var e,t=$("table#list tbody").find("tr"),a=[],i={};$(t).each(function(e,t){$(this).children("td").each(function(e,t){i.id=$("#bus-name").val(),this.classList.contains("tableDriverName")&&0==e&&(i.name=$(this).text()),this.classList.contains("tableDriverDate")&&1==e&&(i.date=$(this).text()),this.classList.contains("tableDriverTime")&&2==e&&(i.time=$(this).text()),2==e&&(a.push(i),i={})})}),e=JSON.stringify(a,null,2),ajax.submitBusDriverAvailability("processDriverAvailability",e)}},ajax={ajaxCall:function(e,t){return $.ajax({type:e,async:!0,cache:!1,url:"mid.php",data:t})},getUsers:function(e,t){ajax.ajaxCall("GET",{method:e,file:"admin_handler"}).done(function(e){console.log("getting users..... "),console.log(e)}).fail(function(e){})},getDrivers:function(e,t){ajax.ajaxCall("GET",{method:e,file:"admin_handler"}).done(function(e){$.each($.parseJSON(e),function(e,t){$("#bus-name").append($("<option>",{value:t.userID,text:t.firstName+" "+t.lastName}))}),$("#bus-name").removeAttr("disabled"),"b"==user.type&&$("select#bus-name option").each(function(){$(this).val()==user.id&&($(this).attr("selected","selected"),$("#bus-name").attr("disabled","disabled"),ajax.getDriverAvailability("returnDriverAvailability",user.id))})}).fail(function(e){})},getDriverAvailability:function(e,t){ajax.ajaxCall("GET",{method:e,data:t,file:"admin_handler"}).done(function(e){var t,a=$("table#list tbody"),i=$("#bus-name").find(":selected").text();a.empty(),$.each($.parseJSON(e),function(e,n){t="<tr>",t+='<td scope="row" class="tableDriverName">'+i+"</td>",t+='<td class="tableDriverDate">'+n.date+"</td>",t+='<td class="tableDriverTime" >'+n.time.toUpperCase()+'<a id="delete-date"><i class="fa fa-minus-circle fa-lg pull-right" aria-hidden="true"></i></a></td>',t+="</tr>",a.append(t)})}).fail(function(e){})},getAvailabilityByDay:function(e,t){ajax.ajaxCall("GET",{method:e,data:t,file:"busDriver_handler"}).done(function(e){var t=$("#availErrorContainer"),a=$("table#schedule-list tbody"),i=$.parseJSON(e).length;t.empty(),a.empty(),i>0?$.each($.parseJSON(e),function(e,t){html="<tr>",html+='<td scope="row" class="tableDriverName" data-id="'+t.userID+'">'+t.firstName+" "+t.lastName+"</td>",html+='<td class="tableDriverTime" >'+t.time.toUpperCase()+"</td>",html+='<td id="driverRole" class="roleSelect">',html+='<input type="radio" name="role_'+e+'" value="driver"> Driver <br/>',html+='<input type="radio" name="role_'+e+'" value="backup"> Backup <br/>',html+='<a href="#" id="clearRoles">Clear</a>',html+="</td>",html+="</tr>",a.append(html)}):$("#schedule-header-date").text()&&t.append('<h3 class="noAvailError">No Availability Found For Today</h3>')}).fail(function(e){})},submitBusDriverAvailability:function(e,t){ajax.ajaxCall("POST",{method:e,data:t,file:"busDriver_handler"}).done(function(e){var t=$(".responseMessage");t.empty(),1==e?t.append('<p class="success">Sumbmitted Successfully</p>'):0==e&&t.append('<p class="error">An error occurred</p>')}).fail(function(e){})},submitCongregationBlackouts:function(e,t){ajax.ajaxCall("POST",{method:e,data:t,file:"blackout_handler"}).done(function(e){var t=$(".responseMessage");t.empty(),1==e?t.append('<p class="success">Sumbmitted Successfully</p>'):0==e&&t.append('<p class="error">An error occurred</p>')}).fail(function(e){})},getCongregations:function(e,t){ajax.ajaxCall("GET",{method:e,file:"congregation_handler"}).done(function(e){$.each($.parseJSON(e),function(e,t){$("#cong-name").append($("<option>",{value:t.congID,text:t.congName}))}),$("#cong-name").removeAttr("disabled"),"c"==retCong.type&&$("select#cong-name option").each(function(){$(this).val()==retCong.cid&&($(this).attr("selected","selected"),$("#cong-name").attr("disabled","disabled"))})}).fail(function(e){})},getBlackouts:function(e,t){ajax.ajaxCall("GET",{method:e,data:t,file:"admin_handler"}).done(function(e){var t,a=$("table#blackout-list tbody"),i=$("#cong-name").find(":selected").text();a.empty(),$.each($.parseJSON(e),function(e,n){t="<tr>",t+='<td scope="row" class="tableCongName">'+i+"</td>",t+='<td class="tableCongDate">'+n.startDate.substring(0,10)+"</td>",t+='<td class="tableCongDate" >'+n.endDate.substring(0,10)+'<a id="delete-blackout"><i class="fa fa-minus-circle fa-lg pull-right" aria-hidden="true"></i></a></td>',t+="</tr>",a.append(t)})}).fail(function(e){})},submitBusDriverSchedule:function(e,t){ajax.ajaxCall("GET",{method:e,data:t,file:"busDriver_handler"}).done(function(e){console.log("submitBusDriverSchedule.done()......."),console.log(e)}).fail(function(e){})}};$(document).ready(function(){$("body").hasClass("bus")&&(bus.init(),$("#date-picker").multiDatesPicker({inline:!0,altField:"#bus-date",dateFormat:"yy-mm-dd"}),$("#bus-date").change(function(){$("#date-picker").multiDatesPicker("setDate",$(this).val())}),$(function(){$('[data-toggle="tooltip"]').tooltip()})),$("body").hasClass("admin")&&(admin.init(),$("#add-user-type").change(function(){"c"==$(this).val()?$("#congregation-select-div").show():$("#congregation-select-div").hide()})),$("body").hasClass("init_login")&&login.init(),$("body").hasClass("cong-schedule")&&($(function(){$('[data-toggle="tooltip"]').tooltip()}),cong_schedule.init()),$("body").hasClass("cong-blackouts")&&(cong_blackouts.init(),$("#blackout-calendar").multiDatesPicker({inline:!0,altField:"#cong-date",maxPicks:1,dateFormat:"yy-mm-dd"}),$(function(){$('[data-toggle="tooltip"]').tooltip()})),$("body").hasClass("bus-schedule")&&(bus_schedule.init(),$("#bus-schedule").multiDatesPicker({inline:!0,maxPicks:1,dateFormat:"yy-mm-dd",altField:"#alt-Input",onSelect:function(){var e=$("#alt-Input").attr("value");$("#schedule-header-date").text(e),ajax.getAvailabilityByDay("returnAvailabilityOnDay",e)}}),$(function(){$('[data-toggle="tooltip"]').tooltip()})),$(".generatePDF")});var login={init:function(){this.bindEvents()},bindEvents:function(){login.validateLogin(),login.validateEmail(),login.validatePassword()},validateLogin:function(){$("form[name='loginForm']").validate({rules:{account:{required:!0,email:!0},secure:{required:!0}},submitHandler:function(e){e.submit()},messages:{account:{required:"Can't leave email empty"},secure:{required:"Can't leave password empty"}}})},validateEmail:function(){$("form[name='passwordReset']").validate({rules:{account:{required:!0,email:!0}},submitHandler:function(e){e.submit()},messages:{account:{required:"Can't leave email empty"}}})},validatePassword:function(){$("form[name='newFormPassword']").validate({rules:{password:{required:!0,minlength:8,maxlength:50},confirm:{required:!0,equalTo:"#newPassword"}},submitHandler:function(e){e.submit()},messages:{password:{required:"Can't leave password empty"},confirm:{equalTo:"Your confirmed password doesn't match"}}})}},utils={saveAsPDF:function(){}},cong_blackouts={init:function(){this.bindEvents()},bindEvents:function(){this.populateCongregations(),$(".add-to-list").on("click",function(e){var t=!1;e.preventDefault(),$("#error-container").empty(),""==$("#cong-name").val()&&(t=!0,$("#error-container").append("<p>A Congregation is required.</p>")),""==$("#cong-date").val()&&(t=!0,$("#error-container").append("<p>Date(s) is/are required.</p>")),t||cong_blackouts.populateTable()}),$("#cong-blackout-submit").on("click",function(e){e.preventDefault(),cong_blackouts.submitBlackouts()}),$("#cong-name").on("change",function(e){$("option:selected",this);var t=this.value;""!=t&&ajax.getBlackouts("returnBlackouts",t)}),$("table#blackout-list").on("click","a#delete-blackout",function(e){e.preventDefault(),cong_blackouts.removeBlackoutRecord(this)})},populateTable:function(){var e,t=$("#cong-name").find(":selected").text(),a=$("#cong-date").val(),i=$("table#blackout-list tbody"),n=$("#blackout-calendar").datepicker("getDate"),r=n.getFullYear(),l=n.getMonth(),s=n.getUTCDay(),o=new Date(r,l,n.getDate()-s,0,0,0,0),c=new Date(o.getFullYear(),o.getMonth(),o.getDate()+7,0,0,0,0),d=cong_blackouts.getProperDateFormat(o),u=cong_blackouts.getProperDateFormat(c);0==cong_blackouts.checkExists(a)&&(e="<tr>",e+='<td scope="row" class="tableCongName">'+t+"</td>",e+='<td class="tableCongDate">'+d+"</td>",e+='<td class="tableCongDate">'+u+'<a id="delete-blackout"><i class="fa fa-minus-circle fa-lg pull-right" aria-hidden="true"></i></a></td>',e+="</tr>",i.append(e)),$("#blackout-calendar").multiDatesPicker("removeIndexes",0)},removeBlackoutRecord:function(e){$(e).parents().closest("tr").empty().remove()},getProperDateFormat:function(e){return e.toISOString().substring(0,10)},checkExists:function(e){var t=$("#error-container"),a=($("table#blackout-list tbody"),$("table#blackout-list tbody > tr")),i=!1;if(t.empty(),a.length>0){var n,r,l;$.each(a,function(a,s){l=$(s).find("td.tableCongDate"),$.each(l,function(a,l){0==a&&(n=$(l).text()),1==a&&(r=$(l).text(),e>=n&&e<=r&&(t.append("<p>Blackout Already Exists Between "+n+" and "+r+"</p>"),i=!0))})})}else i=!1;return i},populateCongregations:function(){ajax.getCongregations("returnCongregations")},submitBlackouts:function(){var e,t=$("table#blackout-list tbody").find("tr"),a=[],i={};$(t).each(function(e,t){$(this).children("td").each(function(e,t){i.id=$("#cong-name").val(),this.classList.contains("tableCongDate")&&1==e&&(i.start_date=$(this).text()),this.classList.contains("tableCongDate")&&2==e&&(i.end_date=$(this).text()),2==e&&(a.push(i),i={})})}),e=JSON.stringify(a,null,2),ajax.submitCongregationBlackouts("processBlackouts",e)}},cong_schedule={init:function(){this.bindEvents()},bindEvents:function(){$(function(){$("table.sortCongregations").sortable({items:"td.sort-cong-name"}).disableSelection()})}},user={type:null,id:null},matt={type:null,id:null,cid:null};